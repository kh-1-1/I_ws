# 使用指南

<cite>
**本文档中引用的文件**  
- [run_exp.py](file://NeuPAN/example/run_exp.py)
- [corridor.py](file://RDA-planner/example/corridor/corridor.py)
- [neupan.py](file://NeuPAN/neupan/neupan.py)
- [pan.py](file://NeuPAN/neupan/blocks/pan.py)
- [README.md](file://NeuPAN/README.md)
</cite>

## 目录
1. [简介](#简介)
2. [NeuPAN 使用流程](#neupan-使用流程)
3. [RDA-planner 使用流程](#rda-planner-使用流程)
4. [参数配置与调优](#参数配置与调优)
5. [高级使用技巧](#高级使用技巧)
6. [常见问题与解答](#常见问题与解答)

## 简介
本文档旨在为用户提供NeuPAN和RDA-planner两种规划算法的详细使用指南。内容涵盖从环境配置、参数设置、运行仿真到结果分析的完整工作流程。通过实际示例代码，帮助初学者快速上手，并为经验丰富的开发者提供性能优化建议。

## NeuPAN 使用流程

NeuPAN是一种基于近端交替最小化网络的实时路径规划算法，适用于差速驱动和阿克曼转向机器人。其核心入口点为`run_exp.py`，该脚本通过加载YAML配置文件来初始化规划器并运行仿真。

使用流程如下：
1. 选择示例场景（如走廊、动态障碍物等）
2. 指定机器人运动学类型（差速或阿克曼）
3. 配置是否保存动画、全屏显示等选项
4. 启动仿真并观察规划结果

脚本支持命令行参数，允许用户灵活切换不同场景和配置。例如，可通过`--example`指定场景，`--kinematics`选择机器人类型。

**Section sources**
- [run_exp.py](file://NeuPAN/example/run_exp.py#L0-L93)
- [README.md](file://NeuPAN/README.md#L180-L200)

## RDA-planner 使用流程

RDA-planner基于模型预测控制（MPC）实现，适用于复杂环境下的路径跟踪任务。其典型使用示例位于`corridor.py`中。

使用流程包括：
1. 定义起点和终点坐标
2. 使用曲线生成器创建参考路径（如Dubins曲线）
3. 初始化仿真环境
4. 创建MPC控制器实例
5. 在循环中执行控制指令并更新环境状态

该规划器能够处理静态和动态障碍物，并实时生成最优速度指令。仿真结束后可自动保存动画文件以便后续分析。

**Section sources**
- [corridor.py](file://RDA-planner/example/corridor/corridor.py#L0-L50)

## 参数配置与调优

### NeuPAN关键参数
NeuPAN的性能受多个参数影响，主要包括：
- **receding**: 预测时域长度
- **nrmp_max_num**: NRMP层最大节点数
- **dune_max_num**: DUNE层最大节点数
- **iter_num**: 迭代次数
- **iter_threshold**: 收敛阈值

建议在Intel i7及以上CPU平台上运行，以确保控制频率超过10Hz。可通过调整上述参数平衡计算效率与规划质量。

### 调整行为参数
通过`update_adjust_parameters`方法可动态调整以下参数：
- `q_s`: 状态代价权重
- `p_u`: 速度代价权重
- `eta`: 避障代价权重
- `d_max`: 最大避障距离
- `d_min`: 最小安全距离

这些参数直接影响规划器的激进或保守程度，可根据具体应用场景进行微调。

**Section sources**
- [neupan.py](file://NeuPAN/neupan/neupan.py#L62-L101)
- [neupan.py](file://NeuPAN/neupan/neupan.py#L321-L379)
- [README.md](file://NeuPAN/README.md#L180-L200)

## 高级使用技巧

### 初始路径生成
NeuPAN支持从全局规划器（如A*）获取粗略路径作为初始猜测。系统提供多种路径生成方式：
- 差速机器人：直线连接
- 前向阿克曼车辆：Dubins路径
- 前后向阿克曼车辆：Reeds-Shepp路径

### 多传感器融合
NeuPAN可接受任意传感器提供的2D点云数据作为障碍物输入。对于3D激光雷达，可通过投影到地面平面转换为2D点；对于相机，则需先提取2D特征点。

### 实际部署
通过[neupan_ros](https://github.com/hanruihua/neupan_ros)可将算法部署到真实机器人平台。训练好的DUNE模型无需重新训练即可直接应用于真实环境。

**Section sources**
- [README.md](file://NeuPAN/README.md#L180-L200)
- [pan.py](file://NeuPAN/neupan/blocks/pan.py#L0-L25)

## 常见问题与解答

### 如何选择合适的规划器？
- 对于需要高实时性的场景，推荐使用NeuPAN
- 对于精确路径跟踪任务，建议采用RDA-planner
- 复杂动态环境可结合两者优势进行混合使用

### 性能优化建议
- 使用高性能CPU以提高计算速度
- 根据场景复杂度适当减少`nrmp_max_num`和`dune_max_num`
- 调整`receding`和`iter_num`以平衡响应速度与规划精度

### 错误处理
当`info["stop"]`为True时，表示因距离过近而停止；`info["arrive"]`为True则表示已到达目标点。用户应在主循环中检查这些标志位并作出相应处理。

**Section sources**
- [run_exp.py](file://NeuPAN/example/run_exp.py#L0-L93)
- [README.md](file://NeuPAN/README.md#L210-L214)